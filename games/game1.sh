#!/bin/bash

# ê²Œì„ ì´ˆê¸°í™” ë° ëœë¤ ìˆ«ì ìƒì„±
initialize_game() {
    secret_number=($(shuf -i 0-9 -n 3))
    attempts=0
    user_inputs=()
    results=()  # ê° ì…ë ¥ì— ëŒ€í•œ ê²°ê³¼ë¥¼ ì €ì¥í•  ë°°ì—´

    # ì•„ìŠ¤í‚¤ì•„íŠ¸ í—¤ë”
    echo -e "\n"
    echo "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—       "
    echo "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘       "
    echo "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘       "
    echo "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘       "
    echo "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  "
    
    echo -e "âš¾ ìˆ«ì ì•¼êµ¬ ê²Œì„ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! âš¾\n"

    echo "ê²Œì„ì˜ ë£°:"
    echo -e "1. ìˆ«ì3ìë¦¬ë¥¼ë§ì¶”ì„¸ìš”. (0ë¶€í„° 9ê¹Œì§€ ì„œë¡œ ë‹¤ë¥¸ ìˆ«ì)"
    echo -e "2. ìŠ¤íŠ¸ë¼ì´í¬ëŠ” ìë¦¬ë¥¼ ì •í™•íˆ ë§ì¶˜ ìˆ«ìì…ë‹ˆë‹¤."
    echo -e "3. ë³¼ì€ ìˆ«ìëŠ” ë§ì•˜ìœ¼ë‚˜ ìë¦¬ê°€ í‹€ë¦° ìˆ«ìì…ë‹ˆë‹¤."
    echo -e "4. ê¸°íšŒëŠ” 12ë²ˆì…ë‹ˆë‹¤!"
}

# ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
get_user_input() {
    while true; do
        echo -n "âš¾ ì„¸ ìë¦¬ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 123): "
        read input
        formatted_input=$(echo "$input" | tr -d ' ')  # ì…ë ¥ê°’ì—ì„œ ê³µë°± ì œê±°

        # ê²Œì„ ì¢…ë£Œ ëª…ë ¹ ì²˜ë¦¬
        if [[ "$formatted_input" == "exit" ]]; then
            echo -e "ğŸ® ê²Œì„ì„ ì¢…ë£Œí•©ë‹ˆë‹¤. ì¦ê±°ìš´ ì‹œê°„ ë˜ì„¸ìš”! âš¾"
            exit 0
        fi

        # ì…ë ¥ê°’ ìœ íš¨ì„± ê²€ì‚¬
        if [[ ! "$formatted_input" =~ ^[0-9]{3}$ ]]; then
            echo -e "âŒ ì˜ëª»ëœ ì…ë ¥ì…ë‹ˆë‹¤. ì„¸ ìë¦¬ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”."
        elif [[ $(echo "$formatted_input" | grep -o . | sort | uniq -d | wc -l) -gt 0 ]]; then
            echo -e "âŒ ì¤‘ë³µëœ ìˆ«ìê°€ ìˆìŠµë‹ˆë‹¤. ê° ìˆ«ìëŠ” ë‹¬ë¼ì•¼ í•©ë‹ˆë‹¤."
        else
            # ì…ë ¥ì´ ì˜¬ë°”ë¥´ë©´ ë£¨í”„ ì¢…ë£Œ
            user_guess=($(echo "$formatted_input" | grep -o .))
            user_inputs+=("$formatted_input")  # ì…ë ¥ê°’ ê¸°ë¡
            break
        fi
    done
}

# ê²°ê³¼ ê³„ì‚° (ìŠ¤íŠ¸ë¼ì´í¬ì™€ ë³¼ íŒì •)
check_result() {
    strikes=0
    balls=0

    for i in {0..2}; do
        if [[ "${user_guess[$i]}" -eq "${secret_number[$i]}" ]]; then
            ((strikes++))
        elif [[ " ${secret_number[@]} " =~ " ${user_guess[$i]} " ]]; then
            ((balls++))
        fi
    done

    attempts=$((attempts + 1))

    if [[ $strikes -eq 0 && $balls -eq 0 ]]; then
        results+=("OUT")
        echo -e "âš¾ ê²°ê³¼: ğŸ”´ ì•„ì›ƒ!"
    elif [[ $strikes -eq 3 ]]; then
        results+=("Homerun")
        echo -e "ğŸ‰ ê²°ê³¼: í™ˆëŸ°! ì •ë‹µ(${secret_number[@]})ì„ ë§ì¶”ì…¨ìŠµë‹ˆë‹¤! ğŸ‰ ì‹œë„ íšŸìˆ˜: ${attempts}ë²ˆ"
        exit 0  # ì„±ê³µ ì‹œ ì¢…ë£Œ ì½”ë“œ 0 ë°˜í™˜
    else
        results+=("${strikes} ìŠ¤íŠ¸ë¼ì´í¬, ${balls} ë³¼")
        echo -e "âš¾ ê²°ê³¼: ${strikes} ìŠ¤íŠ¸ë¼ì´í¬, ${balls} ë³¼"
    fi
}

# ì´ì „ ì…ë ¥ê°’ ë° ê²°ê³¼ í‘œì‹œ
display_previous_inputs() {
    echo -e "\n===================== ì´ì „ ì…ë ¥ ê¸°ë¡ ====================="
    for i in "${!user_inputs[@]}"; do
        echo -e "  $((i + 1))ë²ˆì§¸ ì…ë ¥: ${user_inputs[$i]} - ê²°ê³¼: ${results[$i]}"
    done
    echo -e "=========================================================="
}

# ê²Œì„ ë©”ì¸ ë£¨í”„
play_game() {
    initialize_game

    while true; do
        display_previous_inputs
        get_user_input
        check_result

        # 12ë²ˆ ê¸°íšŒ ì´ˆê³¼ ì‹œ íŒ¨ë°° ì²˜ë¦¬
        if [[ $attempts -ge 12 ]]; then
            echo -e "ğŸ’¥ íŒ¨ë°°í•˜ì…¨ìŠµë‹ˆë‹¤! 12ë²ˆì˜ ê¸°íšŒë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ì •ë‹µì€ ${secret_number[@]}ì˜€ìŠµë‹ˆë‹¤. ğŸ’¥"
            exit 1  # íŒ¨ë°° ì‹œ ì¢…ë£Œ ì½”ë“œ 1 ë°˜í™˜
        fi
    done
}

# í”„ë¡œê·¸ë¨ ì‹œì‘
play_game

